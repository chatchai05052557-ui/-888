<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard: ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</title>
    <style>
        /* Modern Clean Design */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #e9ebee; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: auto; background: #ffffff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h2 { text-align: center; color: #3b5998; margin-bottom: 25px; font-weight: 600; }
        .input-group { display: flex; align-items: center; margin-bottom: 20px; gap: 10px; }
        input[type="file"] { 
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô input ‡πÄ‡∏î‡∏¥‡∏° */
        }
        .file-label {
            background-color: #4CAF50; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
            white-space: nowrap;
        }
        .file-label:hover { background-color: #45a049; }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .btn-primary { background-color: #3b5998; color: white; }
        .btn-primary:hover { background-color: #2b4478; }
        .btn-clear { background-color: #dc3545; color: white; }
        .btn-clear:hover { background-color: #c82333; }

        #fileNames { 
            flex-grow: 1; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background-color: #f7f7f7; 
            min-height: 40px; 
        }

        /* Table Styles */
        #dataTable { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 30px; font-size: 14px; }
        #dataTable th, #dataTable td { padding: 12px 15px; border-bottom: 1px solid #eee; }
        #dataTable th { 
            background-color: #3b5998; 
            color: white; 
            text-align: left; 
            position: sticky;
            top: 0;
            z-index: 10;
        }
        #dataTable tr:nth-child(even) { background-color: #f9f9f9; }
        #dataTable tr:hover { background-color: #f1f1f1; }
        
        .instruction { background-color: #e7f3fe; border-left: 5px solid #2196F3; padding: 15px; margin-bottom: 25px; color: #0c5460; border-radius: 6px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üîë ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• Tournament Dashboard</h2>
    
    <div class="instruction">
        **‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
        <br>1. ‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå **CSV** ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
        <br>2. ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° **"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå"** ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡πÑ‡∏ß‡πâ
        <br>3. ‡∏Å‡∏î **"‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    </div>

    <div class="input-group">
        <label for="csvFile" class="file-label">
            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
            <input type="file" id="csvFile" accept=".csv" multiple onchange="updateFileNames()">
        </label>
        <span id="fileNames">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏î ‡πÜ</span>
    </div>

    <div style="display: flex; gap: 10px;">
        <button class="btn btn-primary" onclick="processFiles()">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button class="btn btn-clear" onclick="clearTable()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
    </div>
    
    <table id="dataTable">
        <thead>
            <tr></tr> </thead>
        <tbody>
        </tbody>
    </table>
</div>

<script>
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    function updateFileNames() {
        const fileInput = document.getElementById('csvFile');
        const fileNamesDisplay = document.getElementById('fileNames');
        const files = fileInput.files;

        if (files.length === 0) {
            fileNamesDisplay.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏î ‡πÜ';
        } else {
            const names = Array.from(files).map(file => file.name);
            fileNamesDisplay.textContent = `‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ${files.length} ‡πÑ‡∏ü‡∏•‡πå: ${names.join(', ')}`;
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function clearTable() {
        document.getElementById('dataTable').getElementsByTagName('tbody')[0].innerHTML = '';
        document.getElementById('dataTable').getElementsByTagName('thead')[0].rows[0].innerHTML = '';
        document.getElementById('fileNames').textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏î ‡πÜ';
        document.getElementById('csvFile').value = null; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï input file
        alert('‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå CSV
    function processFiles() {
        const fileInput = document.getElementById('csvFile');
        const files = fileInput.files;

        if (files.length === 0) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå');
            return;
        }

        const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
        const tableHeadRow = document.getElementById('dataTable').getElementsByTagName('thead')[0].rows[0];
        
        tableBody.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
        tableHeadRow.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Header ‡πÄ‡∏Å‡πà‡∏≤

        let allData = [];
        let headerSet = false;

        const readFile = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const csvText = e.target.result;
                        const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== ''); 
                        
                        if (lines.length > 0) {
                            let headerLine = lines[0].replace(/"/g, ''); 
                            let headers = headerLine.split(',');

                            if (!headerSet) {
                                // ‡πÅ‡∏™‡∏î‡∏á Header ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏£‡∏Å
                                headers.forEach(header => {
                                    let th = document.createElement('th');
                                    th.textContent = header;
                                    tableHeadRow.appendChild(th);
                                });
                                headerSet = true;
                            }

                            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ)
                            for (let i = 1; i < lines.length; i++) {
                                // ‡πÉ‡∏ä‡πâ regex ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ quotes ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Ñ‡πà‡∏≤
                                let rowValues = lines[i].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/); 
                                let dataRow = rowValues.map(v => v.replace(/^"|"$/g, '').replace(/""/g, '"'));
                                
                                if (dataRow.some(item => item.trim() !== '') && dataRow.length === headers.length) {
                                    allData.push(dataRow);
                                }
                            }
                        }
                        resolve();
                    } catch (error) {
                        reject(new Error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå ${file.name}: ${error.message}`));
                    }
                };
                reader.onerror = reject;
                reader.readAsText(file, 'UTF-8');
            });
        };

        // ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
        const readers = Array.from(files).map(readFile);
        
        Promise.all(readers)
            .then(() => {
                // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ insertRow() ‡πÅ‡∏ó‡∏ô insertCell() ***
                allData.forEach(rowData => {
                    let newRow = tableBody.insertRow(); // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ insertRow()
                    rowData.forEach(cellData => {
                        let cell = newRow.insertCell();
                        cell.textContent = cellData;
                    });
                });
                alert(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏ß‡∏° ${allData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å ${files.length} ‡πÑ‡∏ü‡∏•‡πå`);
            })
            .catch(error => {
                console.error("Error reading files:", error);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: " + error.message);
            });
    }
</script>
</body>
</html>
